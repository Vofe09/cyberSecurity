<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Mini Game ‚Äî Treasure Catch</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root {
  --bg-light: #e6f8f7;
  --blue-main: #4fd1c5;
  --green: #34d399;
  --red: #f87171;
  --text-dark: #1e293b;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: system-ui, sans-serif;
}

body {
  background: var(--bg-light);
  height: 100vh;
  overflow: hidden;
}

.top {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: white;
  padding: 12px 24px;
  border-radius: 20px;
  display: flex;
  gap: 24px;
  font-weight: 600;
  box-shadow: 0 10px 25px rgba(0,0,0,.15);
  z-index: 10;
}

.game-area {
  position: relative;
  width: 100%;
  height: 100%;
}

.item {
  position: absolute;
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 26px;
  cursor: pointer;
  user-select: none;
  animation: pop 0.2s ease;
}

@keyframes pop {
  from { transform: scale(0); }
  to { transform: scale(1); }
}

.good {
  background: var(--green);
}

.bad {
  background: var(--red);
}
</style>
</head>

<body>

<div class="top">
  <div>‚è± <span id="time">30</span>s</div>
  <div>‚≠ê –û—á–∫–∏: <span id="score">0</span></div>
</div>

<div class="game-area" id="game"></div>

<script>
/* ==========================
   –ù–ê–°–¢–†–û–ô–ö–ò
========================== */
const GAME_TIME = 30;

let spawnIntervalMs = 900;   // –º–µ–¥–ª–µ–Ω–Ω–æ –≤ –Ω–∞—á–∞–ª–µ
let minSpawnInterval = 350; // –±—ã—Å—Ç—Ä–µ–µ —ç—Ç–æ–≥–æ –Ω–µ –±—É–¥–µ—Ç

let baseDuration = 2200;    // –º–µ–¥–ª–µ–Ω–Ω—ã–π –ø–æ–ª—ë—Ç –≤ –Ω–∞—á–∞–ª–µ
let minDuration = 900;      // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å

const treasures = ["üíé", "üî∑", "üü¢"]; // –∞–ª–º–∞–∑, —Ä—É–±–∏–Ω, –∏–∑—É–º—Ä—É–¥
const traps = ["‚ò†Ô∏è", "ü¶¥"];

const correctSound = new Audio("sounds/correct.mp3");
const incorrectSound = new Audio("sounds/incorrect.mp3");

// —É–º–µ–Ω—å—à–∏–º –∑–∞–¥–µ—Ä–∂–∫—É
correctSound.preload = "auto";
incorrectSound.preload = "auto";


/* ==========================
   –°–û–°–¢–û–Ø–ù–ò–ï
========================== */
let score = 0;
let timeLeft = GAME_TIME;
let gameInterval;
let spawnInterval;

const game = document.getElementById("game");
const scoreEl = document.getElementById("score");
const timeEl = document.getElementById("time");

/* ==========================
   –°–ü–ê–í–ù –û–ë–™–ï–ö–¢–ê
========================== */
function spawnItem() {
  const item = document.createElement("div");
  item.classList.add("item");

  const isGood = Math.random() > 0.35;
  item.classList.add(isGood ? "good" : "bad");
  item.textContent = isGood
    ? treasures[Math.floor(Math.random() * treasures.length)]
    : traps[Math.floor(Math.random() * traps.length)];

  const fromLeft = Math.random() > 0.5;
  const startX = fromLeft ? -60 : window.innerWidth + 60;
  const endX = fromLeft ? window.innerWidth + 60 : -60;

  const startY = window.innerHeight - 100;
  const peakY = Math.random() * (window.innerHeight / 2);

const duration =
  baseDuration + Math.random() * 300;

  const startTime = performance.now();

  function animate(time) {
    const t = (time - startTime) / duration;
    if (t >= 1) {
      item.remove();
      return;
    }

    const x = startX + (endX - startX) * t;
    const y =
      startY -
      4 * (startY - peakY) * t * (1 - t); // –ø–∞—Ä–∞–±–æ–ª–∞

    item.style.transform = `translate(${x}px, ${y}px)`;
    requestAnimationFrame(animate);
  }

 item.addEventListener("pointerdown", () => {
  if (isGood) {
    score += 2;
    correctSound.currentTime = 0;
    correctSound.play();
  } else {
    score -= 2;
    incorrectSound.currentTime = 0;
    incorrectSound.play();
  }

  scoreEl.textContent = score;
  item.remove();
});


  game.appendChild(item);
  requestAnimationFrame(animate);
}
function spawnLoop() {
  spawnItem();

  spawnInterval = setTimeout(() => {
    if (timeLeft > 0) {
      spawnLoop();
    }
  }, spawnIntervalMs);
}


/* ==========================
   –¢–ê–ô–ú–ï–†
========================== */
function startGame() {
  spawnLoop();

  gameInterval = setInterval(() => {
    
    timeLeft--;
    timeEl.textContent = timeLeft;

    if (timeLeft <= 0) {
      endGame();
    }
  }, 1000);
}


function endGame() {
  clearInterval(gameInterval);
  clearInterval(spawnInterval);
  game.innerHTML = "";

  // —Å–æ—Ö—Ä–∞–Ω—è–µ–º, —Å –∫–∞–∫–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å
  localStorage.setItem(
    "cyberAware:returnToQuestion",
    "3" // ‚Üê –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å 4-–≥–æ –≤–æ–ø—Ä–æ—Å–∞ (–∏–Ω–¥–µ–∫—Å)
  );

  window.location.href = "/game/index.html";
}


/* ==========================
   START
========================== */
startGame();
</script>

</body>
</html>
